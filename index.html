<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Mesut - HelloBase Mini dApp</title>

  <!-- Ethers.js (v5) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>

  <style>
    :root {
      --bg: #020617;
      --bg-card: #020617;
      --border: #1e293b;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.15);
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --text-muted: #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d4ed8 0, #020617 40%, #000 100%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 16px;
    }

    .shell {
      width: 100%;
      max-width: 960px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 20px;
    }

    @media (max-width: 768px) {
      .shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 22px;
      box-shadow:
        0 22px 45px rgba(0, 0, 0, 0.75),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top left, rgba(59,130,246,0.18) 0, transparent 55%);
      opacity: 0.6;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      margin-bottom: 16px;
    }

    .logo-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(51, 65, 85, 0.8);
      font-size: 11px;
      color: var(--text-sub);
    }

    .logo-circle {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: #0ea5e9;
      box-shadow: 0 0 0 3px rgba(14,165,233,0.25);
    }

    h1 {
      font-size: 20px;
      margin: 0;
      color: #e0f2fe;
      letter-spacing: 0.02em;
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }

    .badge {
      font-size: 10px;
      border-radius: 999px;
      padding: 3px 9px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      color: var(--text-sub);
      background: rgba(15, 23, 42, 0.9);
    }

    button {
      background: var(--accent);
      border: none;
      border-radius: 999px;
      color: white;
      padding: 8px 16px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      transition: all 0.15s ease;
    }

    button:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
      box-shadow: 0 10px 30px rgba(37, 99, 235, 0.35);
    }

    button:disabled {
      background: #4b5563;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .btn-secondary {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(51, 65, 85, 0.9);
      color: var(--text-sub);
      box-shadow: none;
    }

    .btn-secondary:hover {
      background: rgba(30, 64, 175, 0.6);
      border-color: #3b82f6;
      color: #e5e7eb;
    }

    .section {
      margin-top: 18px;
    }

    .label-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .label {
      font-size: 11px;
      color: var(--text-sub);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .value-box {
      border-radius: 14px;
      border: 1px solid var(--border);
      padding: 10px 12px;
      background: rgba(15, 23, 42, 0.96);
      font-size: 12px;
      word-break: break-all;
      min-height: 38px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .value-main {
      font-size: 12px;
      color: var(--text-main);
      opacity: 0.9;
    }

    .value-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .pill {
      font-size: 10px;
      border-radius: 999px;
      padding: 3px 7px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      color: var(--text-sub);
    }

    input {
      width: 100%;
      padding: 9px 11px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.96);
      color: var(--text-main);
      font-size: 13px;
      outline: none;
      transition: all 0.12s ease;
    }

    input::placeholder {
      color: #6b7280;
    }

    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(59,130,246,0.7);
    }

    .status {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 4px;
      min-height: 16px;
      white-space: pre-line;
    }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 10px;
    }

    .tag {
      display: inline-flex;
      font-size: 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      padding: 2px 9px;
      color: var(--text-sub);
      margin-right: 6px;
    }

    .side-card-title {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .timeline {
      border-left: 1px solid rgba(51, 65, 85, 0.9);
      margin-left: 5px;
      padding-left: 14px;
      margin-top: 6px;
    }

    .timeline-item {
      margin-bottom: 12px;
      position: relative;
    }

    .timeline-item::before {
      content: "";
      position: absolute;
      left: -15px;
      top: 4px;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #3b82f6;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
    }

    .timeline-title {
      font-size: 12px;
      color: var(--text-main);
    }

    .timeline-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    /* Wallet avatar chip */
    .wallet-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(51, 65, 85, 0.9);
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 8px;
    }

    .wallet-avatar {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
      color: #0b1120;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.9);
    }

    .wallet-label {
      font-size: 11px;
      color: var(--text-main);
    }

    /* Tx history list */
    .tx-list {
      margin-top: 6px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.96);
      padding: 8px 10px;
      max-height: 180px;
      overflow-y: auto;
    }

    .tx-empty {
      font-size: 11px;
      color: var(--text-muted);
    }

    .tx-item {
      font-size: 11px;
      color: var(--text-sub);
      padding: 5px 4px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .tx-item + .tx-item {
      border-top: 1px solid rgba(30, 41, 59, 0.9);
      margin-top: 4px;
    }

    .tx-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .tx-hash {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: #e5e7eb;
    }

    .tx-meta {
      font-size: 10px;
      color: var(--text-muted);
    }

    .tx-link {
      text-decoration: none;
      color: #38bdf8;
    }

    .tx-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- Ana dApp kartƒ± -->
    <div class="card">
      <div class="card-inner">
        <div class="header-row">
          <div>
            <div class="logo-pill">
              <div class="logo-circle"></div>
              <span>Base ‚Ä¢ Onchain Mini dApp</span>
            </div>
            <h1>HelloBase Dashboard</h1>
            <div class="subtitle">
              Mesut‚Äôun Base √ºzerindeki doƒürulanmƒ±≈ü kontratƒ±yla c√ºzdanƒ±ndan direkt etkile≈üime ge√ß.
            </div>
            <div class="badge-row">
              <div class="badge">Deployed ‚Ä¢ 0xD6e4‚Ä¶c8F8</div>
              <div class="badge">Verified on BaseScan</div>
              <div class="badge">Built by Mesut</div>
            </div>
          </div>
          <div>
            <button id="connectButton">
              <span>üîó C√ºzdanƒ± Baƒüla</span>
            </button>
          </div>
        </div>

        <!-- C√ºzdan / Aƒü Bilgisi -->
        <div class="section">
          <div class="label-row">
            <span class="label">Baƒülantƒ± durumu</span>
            <span class="pill">MetaMask ‚Ä¢ Base</span>
          </div>
          <div class="value-box" id="walletInfo">
            <div class="value-main">Baƒülƒ± deƒüil</div>
          </div>

          <!-- Avatar + kƒ±sa adres chip -->
          <div id="walletChipContainer" style="margin-top: 6px; display:none;">
            <div class="wallet-chip">
              <div id="walletAvatar" class="wallet-avatar">--</div>
              <div class="wallet-label" id="walletShortLabel">C√ºzdan baƒülƒ± deƒüil</div>
            </div>
          </div>
        </div>

        <!-- Kontrat Adresi -->
        <div class="section">
          <div class="label-row">
            <span class="label">Kontrat adresi</span>
            <span class="pill">HelloBase.sol</span>
          </div>
          <div class="value-box">
            <div class="value-main">
              0xD6e402b477B05f8105be4fAaC4a43E0355aCc8F8
            </div>
          </div>
        </div>

        <!-- Mesaj Oku -->
        <div class="section">
          <div class="label-row">
            <span class="label">Aktif mesaj (message)</span>
            <button class="btn-secondary" id="refreshMessageButton">Yenile</button>
          </div>
          <div class="value-box">
            <div class="value-main" id="currentMessage">-</div>
          </div>
        </div>

        <!-- Mesaj Yaz -->
        <div class="section">
          <div class="label-row">
            <span class="label">Yeni mesaj yaz</span>
          </div>
          <input id="newMessageInput" placeholder="√ñrn: Merhaba Base, Mesut buradaydƒ± ‚ú®" />
          <div class="label-row" style="margin-top: 10px;">
            <div class="status" id="txStatus"></div>
            <button id="setMessageButton" disabled>Mesajƒ± G√ºncelle</button>
          </div>
        </div>

        <div class="hint">
          <span class="tag">ƒ∞pucu</span>
          Kontratƒ± hangi aƒüda deploy ettiysen (Base Mainnet veya Base Sepolia) MetaMask‚Äôte o aƒüƒ± se√ß.
          ƒ∞≈ülem detayƒ± i√ßin MetaMask‚Äôteki ‚ÄúView on explorer‚Äù linkine tƒ±klayabilirsin.
        </div>

        <!-- ƒ∞≈ülem Ge√ßmi≈üi -->
        <div class="section">
          <div class="label-row">
            <span class="label">Bu dApp ile i≈ülem ge√ßmi≈üin</span>
            <span class="pill">Son 5 i≈ülem</span>
          </div>
          <div class="tx-list" id="txList">
            <div class="tx-empty">Bu dApp √ºzerinden hen√ºz i≈ülem yapmadƒ±n.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Saƒü tarafta k√º√ß√ºk info panel -->
    <div class="card">
      <div class="card-inner">
        <div class="side-card-title">Bu mini dApp ne yapƒ±yor?</div>
        <div class="timeline">
          <div class="timeline-item">
            <div class="timeline-title">1. C√ºzdanƒ±nƒ± baƒülƒ±yorsun</div>
            <div class="timeline-sub">
              MetaMask ile Base aƒüƒ±na baƒülanƒ±yorsun. dApp, sadece sen onay verdiƒüinde i≈ülem g√∂nderiyor.
            </div>
          </div>
          <div class="timeline-item">
            <div class="timeline-title">2. Kontrattaki mesajƒ± okuyor</div>
            <div class="timeline-sub">
              HelloBase kontratƒ±ndaki <code>message()</code> fonksiyonunu √ßaƒüƒ±rƒ±p zincirdeki g√ºncel mesajƒ± g√∂steriyor.
            </div>
          </div>
          <div class="timeline-item">
            <div class="timeline-title">3. On-chain mesaj g√ºncelleme</div>
            <div class="timeline-sub">
              Yazdƒ±ƒüƒ±n yeni mesaj, <code>setMessage()</code> ile doƒürudan Base √ºzerindeki kontrata kaydediliyor.
            </div>
          </div>
          <div class="timeline-item">
            <div class="timeline-title">4. T√ºm i≈ülemler BaseScan‚Äôde izlenebilir</div>
            <div class="timeline-sub">
              Her tx; BaseScan √ºzerinde kontrat adresi ve senin c√ºzdanƒ±n √ºzerinden g√∂r√ºlebilir.
            </div>
          </div>
        </div>

        <div class="hint" style="margin-top: 14px;">
          Bu dApp, Mesut‚Äôun Base ekosisteminde builder olarak ilk adƒ±mlarƒ±nƒ± g√∂sterir.  
          ƒ∞leride buraya: token, NFT, leaderboard ve daha fazla on-chain √∂zellik ekleyebilirsin. üíô
        </div>

        <!-- Sosyal Linkler -->
        <div style="margin-top: 24px;">
          <div class="side-card-title" style="margin-bottom: 12px;">Sosyal Baƒülantƒ±lar</div>

          <div style="display: flex; flex-direction: column; gap: 10px;">

            <!-- Twitter -->
            <a href="https://x.com/soylebisey" target="_blank"
               style="
                 display:flex; align-items:center; gap:10px;
                 padding:10px 14px; border-radius:12px;
                 background:rgba(15,23,42,0.85);
                 border:1px solid rgba(51,65,85,0.7);
                 text-decoration:none; color:#e5e7eb; font-size:13px;
                 transition:all .15s ease;
               "
               onmouseover="this.style.background='rgba(37,99,235,0.25)'; this.style.borderColor='#3b82f6';"
               onmouseout="this.style.background='rgba(15,23,42,0.85)'; this.style.borderColor='rgba(51,65,85,0.7)';">
              <span style="font-size:17px;">üê¶</span>
              <span>X (Twitter)</span>
            </a>

            <!-- GitHub -->
            <a href="https://github.com/Mesut006" target="_blank"
               style="
                 display:flex; align-items:center; gap:10px;
                 padding:10px 14px; border-radius:12px;
                 background:rgba(15,23,42,0.85);
                 border:1px solid rgba(51,65,85,0.7);
                 text-decoration:none; color:#e5e7eb; font-size:13px;
                 transition:all .15s ease;
               "
               onmouseover="this.style.background='rgba(37,99,235,0.25)'; this.style.borderColor='#3b82f6';"
               onmouseout="this.style.background='rgba(15,23,42,0.85)'; this.style.borderColor='rgba(51,65,85,0.7)';">
              <span style="font-size:17px;">üêô</span>
              <span>GitHub</span>
            </a>

            <!-- Paragraph -->
            <a href="https://paragraph.com/@0xf159092ad36e8d0524be07f703866b1866d3d94d" target="_blank"
               style="
                 display:flex; align-items:center; gap:10px;
                 padding:10px 14px; border-radius:12px;
                 background:rgba(15,23,42,0.85);
                 border:1px solid rgba(51,65,85,0.7);
                 text-decoration:none; color:#e5e7eb; font-size:13px;
                 transition:all .15s ease;
               "
               onmouseover="this.style.background='rgba(37,99,235,0.25)'; this.style.borderColor='#3b82f6';"
               onmouseout="this.style.background='rgba(15,23,42,0.85)'; this.style.borderColor='rgba(51,65,85,0.7)';">
              <span style="font-size:17px;">üìù</span>
              <span>Paragraph</span>
            </a>

          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    const ethers = window.ethers;

    // Senin kontrat adresin
    const CONTRACT_ADDRESS = "0xD6e402b477B05f8105be4fAaC4a43E0355aCc8F8";

    // HelloBase ABI
    const CONTRACT_ABI = [
      {
        "inputs": [],
        "name": "message",
        "outputs": [{ "internalType": "string", "name": "", "type": "string" }],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{ "internalType": "string", "name": "newMessage", "type": "string" }],
        "name": "setMessage",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let provider;
    let signer;
    let contract;
    let lastNetworkChainId = null;
    let txHistory = [];

    const connectButton = document.getElementById("connectButton");
    const walletInfo = document.getElementById("walletInfo");
    const currentMessageEl = document.getElementById("currentMessage");
    const refreshMessageButton = document.getElementById("refreshMessageButton");
    const newMessageInput = document.getElementById("newMessageInput");
    const setMessageButton = document.getElementById("setMessageButton");
    const txStatus = document.getElementById("txStatus");

    const walletChipContainer = document.getElementById("walletChipContainer");
    const walletAvatar = document.getElementById("walletAvatar");
    const walletShortLabel = document.getElementById("walletShortLabel");

    const txList = document.getElementById("txList");

    function setWalletVisual(address) {
      if (!address) {
        walletChipContainer.style.display = "none";
        return;
      }

      const short = address.slice(0, 6) + "‚Ä¶" + address.slice(-4);
      const initials = address.slice(2, 4).toUpperCase();

      const segment = address.slice(2, 6);
      let hue = parseInt(segment, 16);
      if (Number.isNaN(hue)) hue = 210;
      hue = hue % 360;

      walletAvatar.textContent = initials;
      walletAvatar.style.background = `linear-gradient(135deg, hsl(${hue},80%,60%), hsl(${(hue + 40) % 360},80%,50%))`;
      walletShortLabel.textContent = short;
      walletChipContainer.style.display = "block";
    }

    function formatTimeAgo(ts) {
      const diffMs = Date.now() - ts;
      const sec = Math.floor(diffMs / 1000);
      if (sec < 60) return "az √∂nce";
      const min = Math.floor(sec / 60);
      if (min < 60) return `${min} dk √∂nce`;
      const hour = Math.floor(min / 60);
      if (hour < 24) return `${hour} saat √∂nce`;
      const day = Math.floor(hour / 24);
      return `${day} g√ºn √∂nce`;
    }

    function saveTxHistory() {
      try {
        localStorage.setItem("helloBaseTxHistory", JSON.stringify(txHistory));
      } catch (e) {
        console.warn("Tx history kaydedilemedi:", e);
      }
    }

    function loadTxHistory() {
      try {
        const raw = localStorage.getItem("helloBaseTxHistory");
        if (!raw) {
          txHistory = [];
        } else {
          txHistory = JSON.parse(raw) || [];
        }
      } catch {
        txHistory = [];
      }
      renderTxHistory();
    }

    function renderTxHistory() {
      if (!txList) return;
      if (!txHistory.length) {
        txList.innerHTML = '<div class="tx-empty">Bu dApp √ºzerinden hen√ºz i≈ülem yapmadƒ±n.</div>';
        return;
      }

      txList.innerHTML = txHistory
        .map((item) => {
          const shortHash = item.hash.slice(0, 6) + "‚Ä¶" + item.hash.slice(-4);
          const timeAgo = formatTimeAgo(item.timestamp);
          const chain = item.chainId ? `chainId: ${item.chainId}` : "";
          const explorer = item.explorerUrl
            ? `<a class="tx-link" href="${item.explorerUrl}" target="_blank">BaseScan</a>`
            : "";

          return `
            <div class="tx-item">
              <div class="tx-row">
                <span class="tx-hash">${shortHash}</span>
                <span class="tx-meta">${timeAgo}</span>
              </div>
              <div class="tx-meta">
                ${chain} ${explorer ? "‚Ä¢ " + explorer : ""}
              </div>
            </div>
          `;
        })
        .join("");
    }

    async function connectWallet() {
      if (!window.ethereum) {
        alert("MetaMask bulunamadƒ±. L√ºtfen Chrome eklentisinin kurulu olduƒüundan emin ol.");
        return;
      }

      try {
        const accounts = await window.ethereum.request({
          method: "eth_requestAccounts"
        });

        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        const network = await provider.getNetwork();
        lastNetworkChainId = network.chainId;

        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

        walletInfo.textContent = `Aƒü chainId: ${network.chainId} | C√ºzdan: ${accounts[0]}`;
        connectButton.textContent = "Baƒülƒ±";
        setMessageButton.disabled = false;

        setWalletVisual(accounts[0]);
        await readMessage();
      } catch (e) {
        console.error(e);
        alert("C√ºzdan baƒülanƒ±rken hata olu≈ütu: " + (e.message || e));
      }
    }

    async function readMessage() {
      if (!contract) {
        currentMessageEl.textContent = "Kontrat baƒülƒ± deƒüil.";
        return;
      }
      try {
        currentMessageEl.textContent = "Y√ºkleniyor...";
        const msg = await contract.message();
        currentMessageEl.textContent = msg || "(Bo≈ü)";
      } catch (e) {
        console.error(e);
        currentMessageEl.textContent = "Mesaj okunurken hata.";
      }
    }

    async function setMessage() {
      if (!contract) {
        alert("√ñnce c√ºzdanƒ± baƒülamalƒ±sƒ±n.");
        return;
      }
      const text = newMessageInput.value.trim();
      if (!text) {
        alert("L√ºtfen bir mesaj yaz.");
        return;
      }

      try {
        txStatus.textContent = "ƒ∞≈ülem g√∂nderiliyor...";
        setMessageButton.disabled = true;

        const tx = await contract.setMessage(text);
        txStatus.textContent = "Onay bekleniyor...";

        const receipt = await tx.wait();

        txStatus.textContent = "ƒ∞≈ülem onaylandƒ± ‚úÖ";
        await readMessage();

        // Tx history'ye ekle
        const explorerUrl =
          lastNetworkChainId === 8453
            ? `https://basescan.org/tx/${tx.hash}`
            : lastNetworkChainId === 84532
            ? `https://sepolia.basescan.org/tx/${tx.hash}`
            : "";

        txHistory.unshift({
          hash: tx.hash,
          timestamp: Date.now(),
          chainId: lastNetworkChainId,
          explorerUrl
        });

        txHistory = txHistory.slice(0, 5); // son 5
        saveTxHistory();
        renderTxHistory();

        setTimeout(() => (txStatus.textContent = ""), 4000);
      } catch (e) {
        console.error(e);
        txStatus.textContent = "ƒ∞≈ülem hatasƒ±: " + (e.message || e);
      } finally {
        setMessageButton.disabled = false;
      }
    }

    connectButton.addEventListener("click", connectWallet);
    refreshMessageButton.addEventListener("click", readMessage);
    setMessageButton.addEventListener("click", setMessage);

    // Sayfa ilk a√ßƒ±ldƒ±ƒüƒ±nda local tx ge√ßmi≈üini y√ºkle
    loadTxHistory();
  </script>
</body>
</html>
